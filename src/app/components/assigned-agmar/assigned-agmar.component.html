<main class="assignment">
  <section class="assignment-header">
    <h1>Visor De OT Asignadas AGMAR</h1>
  </section>
  <section class="assignment-action">
    <div class="external-filter">
      <app-auto-complete-filter
        regex="^[A-Za-z.\-_ ]+$"
        objectField="value"
        objectIdentifierKey="id"
        placeHolder="Ingresa nombre de localidad"
        errorMessage="Solo se permiten letras"
        [(value)]="serviceFilter"
      ></app-auto-complete-filter>
    </div>
    <div class="external-filter">
      <app-auto-complete-filter
        regex="^[A-Za-z0-9.\-_ ]+$"
        objectField="value"
        objectIdentifierKey="id"
        placeHolder="Ingresa nombre de servicio"
        errorMessage="Solo se permiten valores alfanumÃ©ricos"
        [(value)]="serviceFilter"
      ></app-auto-complete-filter>
    </div>
    <button
      id="btn-search-ota"
      class="btn btn-primary p-button w-6rem"
      pButton
      label="Buscar"
    ></button>
    <span class="separator"></span>
    <button
      id="btn-excel-ota"
      icon="pi pi-download"
      class="btn btn-secondary p-button w-14rem"
      pButton
      label="Descargar en Excel"
    ></button>
    <button
      id="btn-filtrar-ota"
      class="btn btn-primary p-button w-14rem"
      pButton
      label="Filtrar"
      (click)="openFilters(filtersPanel, $event)"
    >
      <ico-option class="ico-white h-auto w-auto mr-2"></ico-option>
    </button>
  </section>
  <section class="assignment-table">
    <div [ngStyle]="{ 'max-height': '480px' }" class="overflow-auto">
      <div [ngStyle]="{ 'min-width': '1200px' }">
        <app-table-header [header]="otHeaders">
          <ng-template let-row key="landfall" appTable>
            {{ row.name }}
          </ng-template>
          <ng-template let-row key="eta" appTable>
            {{ row.name }}
          </ng-template>
          <ng-template let-row key="locality" appTable>
            {{ row.name }}
          </ng-template>
          <ng-template let-row key="service" appTable>
            {{ row.name }}
          </ng-template>
          <ng-template let-row key="numberOt" appTable>
            {{ row.name }}
          </ng-template>
          <ng-template let-row key="scheduledTime" appTable>
            {{ row.name }}
          </ng-template>
          <ng-template let-row key="stateId" appTable>
            {{ row.name }}
          </ng-template>
          <ng-template let-row key="numberOs" appTable>
            {{ row.name }}
          </ng-template>
          <ng-template let-row key="accion" appTable>
            {{ row.name }}
          </ng-template>
        </app-table-header>
        <app-table-body
          [loading]="loadingTableData"
          [list]="otAssignmentList"
          [header]="otHeaders"
        >
          <ng-template let-element key="landfall" appTable>{{
            element
          }}</ng-template>
          <ng-template let-element key="eta" appTable>{{
            element | date: 'short'
          }}</ng-template>
          <ng-template let-element key="locality" appTable>{{
            element
          }}</ng-template>
          <ng-template let-element let-row="row" key="service" appTable
            >{{ element }}
            <em
              [ngStyle]="{ cursor: 'pointer' }"
              (click)="openOtMessage(row)"
              *ngIf="row.message"
              class="ml-1 pi pi-envelope"
            ></em
          ></ng-template>
          <ng-template let-element key="numberOt" appTable>{{
            element
          }}</ng-template>
          <ng-template let-element key="scheduledTime" appTable>{{
            element | date: 'shortDate'
          }}</ng-template>
          <ng-template let-element key="stateId" appTable
            ><app-register-status
              [registerStatus]="element"
            ></app-register-status
          ></ng-template>
          <ng-template let-element key="numberOs" appTable>{{
            element
          }}</ng-template>
          <ng-template let-element key="accion" appTable
            ><button (click)="stopPropagation($event)" class="btn btn-light">
              <ico-more class="ico-secondary"></ico-more></button
          ></ng-template>
        </app-table-body>
      </div>
    </div>
  </section>
</main>

<p-dialog
  *ngIf="assignedOtToShowMessage"
  [header]="
    assignedOtToShowMessage.landfall +
    ' - ' +
    (assignedOtToShowMessage.eta | date: 'short')
  "
  [(visible)]="displayMessageModal"
  [modal]="true"
  [style]="{ width: '300px', height: '300px' }"
  [draggable]="false"
  [resizable]="false"
>
  <p class="m-0">
    {{ assignedOtToShowMessage.message }}
  </p>
  <ng-template pTemplate="footer">
    <button
      icon="pi pi-check"
      (click)="closeOtMessage()"
      label="Ok"
      pButton
      class="btn btn-secondary"
    ></button>
  </ng-template>
</p-dialog>

<p-overlayPanel #filtersPanel>
  <ng-template pTemplate>
    <div>
      <div class="filter">
        <div>
          <app-filters></app-filters>
          <div class="col-lg-12 text-right mt-2 mb-4">
            <button
              (click)="filtersPanel.hide()"
              class="btn btn-outline-primary btn-md mr-3"
              style="margin-right: 1rem !important"
              pButton
              label="Cerrar"
            ></button>
            <button
              class="btn btn-secondary btn-md"
              pButton
              label="Aplicar"
            ></button>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</p-overlayPanel>

<p-dialog
  id="filter-dialog"
  header="Filters"
  [(visible)]="displayFiltersModal"
  [modal]="true"
  [style]="{ margin: 0 }"
  [draggable]="false"
  [resizable]="false"
  position="top"
>
  <app-filters></app-filters>
  <ng-template pTemplate="footer">
    <button
      (click)="displayFiltersModal = false"
      class="btn btn-outline-primary btn-md mr-3"
      style="margin-right: 1rem !important"
      pButton
      label="Cerrar"
    ></button>
    <button class="btn btn-secondary btn-md" pButton label="Aplicar"></button>
  </ng-template>
</p-dialog>
